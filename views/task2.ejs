<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 2</title>
</head>
<body>
   <form action="/" method="post">
        <input name="input" id="input" type="text" list="harryPotterCharacter" placeholder="Enter here">
        <datalist id="harryPotterCharacter">
            <option id="option0">Harry Potter</option>
            <option id="option1">Hermoine Granger</option>
            <option id="option2">Ronald Weasely</option>
        </datalist>
        <button type="submit">Submit</button>
   </form> 
   <p style="display: none;" id="data"><%= data %></p>
   <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
   <script>
        let hpData = JSON.parse(document.getElementById("data").innerHTML) 
        function lookForSubstring(toSearchFrom, toSearch) {
            let result = []
            for (let i = 0; i < toSearchFrom.length; i++) {
                if (toSearchFrom[i].toLowerCase().includes(toSearch)) {
                    result.push(toSearchFrom[i])
                }
            }
            return result;
        }

        function lookForCharacterMatches(toSearchFrom, toSearch) {
            let advRes = new Map()
            for (let i = 0; i < toSearchFrom.length; i++) {
                for (let j = 0; j < toSearch.length; j++) {
                    let char = toSearch[j]
                    if (toSearchFrom[i].includes(char)) {
                        if (advRes.get(toSearchFrom[i])) {
                            let charMatches = advRes.get(toSearchFrom[i])
                            advRes.set(toSearchFrom[i], charMatches + 1)

                        }else {
                            advRes.set(toSearchFrom[i], 1)
                        }
                    }
                }
            }
            return advRes;
        }
	
        
        
      
        const url = "https://hp-api.onrender.com/api/characters";
        async function getData() {
            let response = await axios.get(url)
            return response.data;
        }
        let input = document.getElementById("input")
        input.addEventListener("input", updateValue)
        let names = []
        names = hpData.data
        function updateValue(e) {
            let value = e.target.value.toLowerCase();

            let res = lookForSubstring(names, value)
            if (res.length !== 0) {
                for (let j = 0; j < 3; j++) {
                    let option = document.getElementById(`option${j}`)
                    option.innerHTML = res[j]
                }
            }else {
                console.log('reached here')
                res = lookForCharacterMatches(names, value)
                // for (let i = 0; i < res.length; i++) {
                //     console.log(res.entries()[i])
                // }
                let highest = 0
                let character;
                for (let [key, value] of res) {
                    if (value > highest) {
                        highest = value
                        character = key
                    }
                    if (key == 'Draco Malfoy') {
                        console.log(value)
                    }
                }
                console.log(highest)
                console.log(character)
                document.getElementById("option0").innerHTML = character
            }
        }
        
        

   </script>
</body>
</html>
